#textdomain wesnoth-AD

[scenario]
    id=AD_Bonus
    name= _ "Battle for Wesnoth"
    map_data="{~add-ons/Ashievieres_Dogs/maps/AD_Bonus.map}"
    turns=-1
    next_scenario=null
    victory_when_enemies_defeated=no
    carryover_percentage=0
    carryover_add=no
    current_time=0

    {SECOND_WATCH_HOUR1}
    {SECOND_WATCH_HOUR2}
    {SECOND_WATCH_HOUR3}
    {SECOND_WATCH_HOUR4}
    {SECOND_WATCH_HOUR5}
    {SECOND_WATCH_HOUR6}

    {SCENARIO_MUSIC "loyalists.ogg"}

    [time_area]
        {LIGHT_SCHEDULE 0}
        id=campfire
        x=47,44,51,47,50,7,10,7,8,18,24,29,45
        y=25,26,27,29,31,20,17,14,4,5,3,3,30
    [/time_area]

    [side]
        side=1
        controller=human
        {GOLD 500 450 400}
        {INCOME 15 10 5}
        fog=yes
        shroud=no
        share_vision=all
        type=Dark Queen Young
        id=Asheviere
        name= _ "Asheviere"
        profile="portraits/asheviere-young.png"
        extra_recruit=Bowman,Spearman,Heavy Infantryman,Horseman,Cavalryman,Mage,Fencer
        recruit=
        color=purple
        team_name=Queen
        user_team_name= _ "Asheviere's Forces"
        {FLAG_VARIANT loyalist} 

        [unit]
            type=Orcish Warlord 
            canrecruit=yes 
            id=Vashna 
            name=_ "Vashna"
            x,y=49,24 
            extra_recruit=Orcish Grunt,Orcish Archer,Orcish Assassin,Wolf Rider,Troll Whelp, Goblin Spearman 
        [/unit]
    [/side]

    [side]
        side=2
        controller=ai
        {GOLD 250 300 350}
        income=0
        fog=no
        shroud=no
        share_vision=all
        type=AD_Sir_Aran
        id=Aran
        name=_ "Sir Aran"
        [modifications]
            {TRAIT_HEROIC}
            {TRAIT_FEARLESS}
        [/modifications]
        recruit=Horseman,Knight
        color=brown
        team_name=rebels
        user_team_name= _ "Rebels"
        {FLAG_VARIANT long}
        [ai]
            grouping=offensive
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        {GOLD 250 300 350}
        income=0
        fog=no
        shroud=no
        share_vision=all
        type=Ad_Richard
        id=Richard
        name=_ "Richard de Ferres"
        [status]
            unslowable=yes
            unpoisonable=yes
        [/status]
        [modifications]
            {TRAIT_HEROIC}
        [/modifications]
        recruit=Swordsman,Pikeman,Javelineer,Halberdier,Longbowman,Spearman,Lieutenant
        color=white
        team_name=rebels
        user_team_name= _ "Rebels"
        {FLAG_VARIANT long}
        [ai]
            grouping=offensive
        [/ai]
    [/side]

    [side]
        side=4
        controller=ai
        {GOLD 250 300 350}
        income=0
        fog=no
        shroud=no
        share_vision=all
        type=AD_Sir_Grey
        [modifications]
            {TRAIT_HEROIC}
        [/modifications]
        id=Grey
        name=_ "Sir Grey"
        profile=_ "portraits/grey.png"
        recruit=Heavy Infantryman,Shock Trooper,Iron Mauler
        color=black
        team_name=rebels
        user_team_name= _ "Rebels"
        {FLAG_VARIANT long}
        [ai]
            grouping=defensive
        [/ai]
    [/side]
    
    
    {STARTING_VILLAGES_ALL 1}
    {STARTING_VILLAGES_AREA 2 8 17 7}
    {STARTING_VILLAGES_AREA 3 14 6 9}
    {STARTING_VILLAGES_AREA 4 26 3 6}

    [event]
    name=prestart 

        #Aran's guard 

        {UNIT 2 "Halberdier" 7 22 (
        name=_ "Aran's Squire"
        ai_special=guardian
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
        )}
        {UNIT 2 "Halberdier" 7 24 (
        name=_ "Aran's Squire"
        ai_special=guardian
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
        )}

        #Richard's guard 

        {UNIT 3 "General" 12 7 (
        name=_ "Richard's Assistant"
        ai_special=guardian
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
        )}
        {UNIT 3 "General" 10 8 (
        name=_ "Richard's Assistant"
        ai_special=guardian
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
        )}

        #Grey's guard 

        {UNIT 4 "Iron Mauler" 33 4 (
        name=_ "Grey's Bodyguard"
        ai_special=guardian
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
        )}
        {UNIT 4 "Iron Mauler" 35 4 (
        name=_ "Grey's Bodyguard"
        ai_special=guardian
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
        )}
        

        {UNIT 1 "Lieutenant" 40 25 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "Lieutenant" 41 25 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "Lieutenant" 42 24 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "White Mage" 39 25 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "White Mage" 40 24 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "White Mage" 41 24 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}

        {UNIT 1 "Orcish Crossbowman" 45 23 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
       {UNIT 1 "Orcish Slurbow" 46 22 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
       {UNIT 1 "Orcish Slayer" 47 22 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
       {UNIT 1 "Troll Warrior" 44 22 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "Troll Hero" 45 22 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}
        {UNIT 1 "Troll Rocklobber" 46 21 (
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
       )}

        {MODIFY_AI_ADD_GOAL 2 (
            [goal]
                id=target_aran
                name=target_location
                [criteria]
                    x,y=13,22
                [/criteria]
                value=100
            [/goal]
        )}

        {MODIFY_AI_ADD_GOAL 3 (
            [goal]
                id=target_richard
                name=target_location
                [criteria]
                    x,y=18,11
                [/criteria]
                value=100
            [/goal]
        )}

        {MODIFY_AI_ADD_GOAL 4 (
            [goal]
                id=target_grey
                name=target_location
                [criteria]
                    x,y=34,9
                [/criteria]
                value=100
            [/goal]
        )}
    [/event]

    #define CHECK_VICTORY

        [if]
            [variable]
                name=victory 
                numerical_equals=2
            [/variable]
        [then]
            [message]
                side=2,3,4
                canrecruit=yes 
                message=_ "The allies left me alone with the Dark Queen! No, I will not have my entire army destroyed. I'll retreat too."
            [/message]

            [kill]
                side=2,3,4
                animate=no 
            [/kill]

            [message]
                speaker=Vashna
                message=_ "The whole rebel horde is fleeing! Ha-ha-ha-ha! Queen, you're just like the Supreme Leader!"
            [/message]

            [message]
                speaker=Asheviere
                message=_ "Don't compare me to your primitive overlord. I am more than a military chieftain. This victory is due to intelligence, not military might."
            [/message]

            [message]
                speaker=Vashna
                message=_ "But you can't chop an enemy to pieces with your intelligence. My orcs did a good job, though."
            [/message]

            [message]
                speaker=Asheviere
                message=_ "Yeah, and I really appreciated it. "
            [/message]

            [message]
                speaker=Vashna
                message=_ "But why don't you order us to give chase? We could take out these rebels in one or two."
            [/message]

            [message]
                speaker=Asheviere
                message=_ "Because in the chase the army loses discipline and turns into a pack of rabid dogs. Often Garard's soldiers, carried away by the pursuit, were surrounded and killed..."
            [/message]

            [message]
                speaker=Vashna
                message=_ "(Ho-ho-ho, that's for sure! I remember when we rounded up and slaughtered a whole troop of stuck-up knights in a war)"
            [/message]

            [message]
                speaker=Asheviere
                message=_ "So I don't need the extra risk. The East and South of Wesnot are already in my hands, and I hope General Henry, along with Isolde and those orcs, have already taken the North. Slowly but surely, I will strangle the rebels in Dun-Tonk, leaving them no chance to escape my grip."
            [/message]

            [message]
                speaker=Vashna
                message=_ "You fight strangely, Queen, not at all like an orc, but it seems to work. What are your next orders?"
            [/message]

            [message]
                speaker=Asheviere
                message=_ "My orders are to return to Weldin and regroup. Then we'll march on Dun-Tonk. It may be slow, but I want to finish off the rebels by the end of this summer."
            [/message]

            [endlevel]
                result=victory
            [/endlevel]
        [/then]
        [/if]
    #enddef 

    [event]
    name=start 

        [message]
            speaker=Asheviere
            message=_ "It seems the rebels have already set up camp at the other end of the field. So many campfires... so many rebels rejecting my righteous rule."
        [/message] 

        [scroll_to_unit]
            id=Aran 
        [/scroll_to_unit]

        [delay]
            time=300
        [/delay]

        [scroll_to_unit]
            id=Richard
        [/scroll_to_unit]

        [delay]
            time=300
        [/delay]

        [scroll_to_unit]
            id=Grey
        [/scroll_to_unit]

        [delay]
            time=300
        [/delay]

        [message]
            speaker=Vashna
            message=_ "What is our plan, Queen?"
        [/message] 

        [message]
            speaker=Asheviere
            message=_ "How would you spend that battle?"
        [/message] 

        [message]
            speaker=Vashna
            message=_ "Well, I'd put grunts and trolls up front, archers back. Then I'd strike the first night, so that by dawn almost none of the rebels would be alive."
        [/message] 

        [message]
            speaker=Asheviere
            message=_ "Rude. Straightforward. That doesn't work for us. The rebels have a strong army, and attacking them head-on would be risky. Even if we win, I don't think I have enough men left to march on Dan-Tonk."
        [/message] 

        [message]
            speaker=Vashna
            message=_ "And then what do we do?"
        [/message] 

        [message]
            speaker=Asheviere
            message=_ "My husband has always neglected exploration. I think it's important. We'll send a spy to find out the rebel formation first. From that, we will gather and build our army."
        [/message] 

        [objectives]
            silent=no
                [objective]
                    description= _ "Gather your army and prepare to the battle"
                    condition=win
                [/objective]
                [objective]
                    caption= _ "Bonus task:"
                    description= _ "Scout all rebel leaders"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Asheviere"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Vashna"
                    condition=lose
                [/objective]
                [gold_carryover]
                    bonus=no
                    carryover_percentage=0
                    carryover_add=0
                [/gold_carryover]
                [note]
                    description=_ "The first recruited unit will become a scout. He will gave the nightstalk ability and can move instantly."
                [/note]
                [note]
                    description=_ "The battle will start when sun will upset (turn 7). After this, schedule will change to classic."
                [/note]
        [/objectives]   
    [/event]

    [event]
    name=start_with_scouting 
    first_time_only=yes 

            [message]
                speaker=Asheviere 
                message=_ "I see things clearly now; it is good that Garard did not exalt the most talented, but those most like him. Like him, the rebels are convinced of their victory and divide court titles before the battle even begins. Surely they think I will act as my husband did. But I'd be a fool to learn military skills from that hard-headed fool."
            [/message]

            [message]
                speaker=Asheviere 
                message=_ "I know them like the back of my hand. And I will exploit their every weakness.  Richard is acting like a king and trying to control everyone; Aran is eager to fight and wants to pierce me personally with his lance; slow Grey will be stuck in the woods, but he won't dare say a word against Richard. I will act on the principle of divide and conquer."
            [/message]

            [message]
                speaker=Asheviere 
                message=_ "Messenger!"
            [/message]

            [unit]
                {WESNOTH_MESSENGER}
                id=messenger 
                x,y=43,27
                animate=yes 
            [/unit]

            [message]
                sound=horse-canter.wav
                speaker=messenger 
                message=_ "Yes, my Queen?"
            [/message]

            [message]
                speaker=Asheviere 
                message=_ "Take the Garard family sword; hand it to Sir Aran with the words: If you lack courage, accept King Garard's sword, perhaps it will strengthen your hearts."
            [/message]

            [message]
                speaker=messenger 
                message=_ "As you wish."
            [/message]

            [sound]
                name=horse-canter.wav
            [/sound]

            {MOVE_UNIT id=messenger 8 22}
            
            [message]
                speaker=messenger 
                message=_ "Sir Aran! You have a message from Queen Asheviere!"
            [/message]

            [message]
                speaker=Aran 
                message=_ "Interesting! Has the Queen decided to surrender herself to my mercy?"
            [/message]

            [message]
                speaker=messenger 
                message=_ "She gives you this sword and a message:  If you lack courage, accept King Garard's sword, perhaps it will strengthen your hearts."
            [/message]

            [message]
                speaker=Aran 
                message=_ ". . ."
            [/message]

            [message]
                speaker=Aran 
                message=_ "! ! !"
            [/message]

            [message]
                speaker=Aran 
                message=_ "How dare you bring me such an insulting message?!"
            [/message]

            [harm_unit]
                [filter]
                    id=messenger 
                [/filter]
                [filter_second]
                    id=Aran 
                [/filter_second]
                amount=100
                kill=yes 
                animate=yes 
            [/harm_unit]

            [message]
                sound=horn-signals/horn-1.ogg
                speaker=Aran 
                message=_ "That's enough! I'm not going to stand here and be insulted by that whore! I will personally finish her off! Knights, attack!"
            [/message]

            [modify_ai]
                side=2
                action=delete
                path=goal[target_aran]
            [/modify_ai]

            [message]
                speaker=Asheviere 
                message=_ "It's just like I planned. Give the knights a warm welcome."
            [/message]

            [event]
            name=turn 8

                [message]
                    speaker=Richard
                    message=_ "Aran, damn you! Why did you send the knights to attack? You're ruining our plan!"
                [/message]

                [message]
                    speaker=Aran 
                    message=_ "You're not a king to tell me what to do, Richard. I attack when I see fit."
                [/message]

                [message]
                    sound=horn-signals/horn-2.ogg
                    speaker=Richard
                    message=_ "Ar, we're gonna have to back this idiot up or we're gonna get smashed one by one! Men, attack!"
                [/message]

                [modify_ai]
                    side=3
                    action=delete
                    path=goal[target_richard]
                [/modify_ai]

                [event]
                name=turn 9

                    [message]
                        sound=horn-signals/horn-3.ogg
                        speaker=Grey
                        message=_ "I don't know what they're up to, but the plan is for us to attack now. Infantry, let's go! Let's crush the Asheviere dogs. "
                    [/message]

                    [modify_ai]
                        side=4
                        action=delete
                        path=goal[target_grey]
                    [/modify_ai]
                [/event]
            [/event]
    [/event] 

    [event]
    name=start_without_scouting 
    first_time_only=yes 

        [message]
            sound=horn-signals/horn-1.ogg
            speaker=Richard 
            message=_ "The sun is up, our soldiers are ready. It's time to begin the battle. Forward!"
        [/message]

        [message]
            sound=horn-signals/horn-2.ogg
            speaker=Aran
            message=_ "Asheviere is a complete fool to leave the walls of Weldyn and take the fight to the plains. My cavalry will crush her pathetic army in seconds!"
        [/message]

        [message]
            sound=horn-signals/horn-3.ogg
            speaker=Grey
            message=_ "And my infantry will finish what the cavalry will start. Forward, soldiers! For Wesnoth!"
        [/message]

        [message]
            speaker=Asheviere
            message=_ "Damn it, I didn't have time to come up with a cunning plan. I can only hope for the courage and fortitude of my soldiers."
        [/message]

        [message]
            speaker=Vashna
            message=_ "Don't trouble yourself. If anything, we'll keep order with our blades. "
        [/message]

        [message]
            speaker=Asheviere
            message=_ "I hope it doesn't come to that. Do your job, orc."
        [/message]

        [modify_ai]
            side=2
            action=delete
            path=goal[target_aran]
        [/modify_ai]

        [modify_ai]
            side=3
            action=delete
            path=goal[target_richard]
        [/modify_ai]

        [modify_ai]
            side=4
            action=delete
            path=goal[target_grey]
        [/modify_ai]
    [/event]

    [event]
    name=recruit 
    id=scout
    first_time_only=yes 

        [filter]
            side=1 
        [/filter]

        [object]
            id=scout
            duration=scenario
            [filter]
                find_in=unit 
            [/filter]
        
            [effect]
                apply_to=new_ability 
                [abilities]
                    {ABILITY_NIGHTSTALK}
                [/abilities]
            [/effect]
        [/object]

        [modify_unit]
            [filter]
                find_in=unit 
            [/filter]
            moves=unit.max_moves
            role=scout
        [/modify_unit]

        [message]
            speaker=unit 
            message="I'm going on a scouting mission." 
        [/message]
    [/event]

    [event]
    name=turn 7 

        [modify_side]
            side=1 
            fog=no 
        [/modify_side]

        [replace_schedule]
            {DAWN}
            {MORNING}
            {AFTERNOON}
            {DUSK} 
            {FIRST_WATCH}
            {SECOND_WATCH} 
        [/replace_schedule]

        {REPLACE_SCENARIO_MUSIC battle.ogg}
        {APPEND_MUSIC battle-epic.ogg}
        {APPEND_MUSIC the_city_falls.ogg}

        [remove_object]
            object_id=scout 
        [/remove_object]
        [remove_event]
            id=scout 
        [/remove_event]

        [if]
            [variable]
                name=scout 
                numerical_equals=3
            [/variable]
        [then]
            [fire_event]
                name=start_with_scouting 
            [/fire_event]
        [/then]
        [else]
            [fire_event]
                name=start_without_scouting 
            [/fire_event]
        [/else]
        [/if]

        [objectives]
            silent=no
                [objective]
                    description= _ "Defeat 2 of rebels lords"
                    condition=win
                [/objective]
                [objective]
                    description= _ "Death of Asheviere"
                    condition=lose
                [/objective]
                [objective]
                    description= _ "Death of Vashna"
                    condition=lose
                [/objective]
                [note]
                    description=_ "Defeating lord will gave him 100 less gold in last scenario."
                [/note]
        [/objectives]   
    [/event]

    [event]
    name=sighted 

        [filter]
            id=Aran 
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            scroll=no
            speaker=Asheviere
            message=_ "So Sir Aran's knights are on the rebels' right flank. Then we must move more spearmen and archers against them."
        [/message]

        {VARIABLE_OP scout add 1}
    [/event]

    [event]
    name=sighted 

        [filter]
            id=Richard
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            scroll=no
            speaker=Asheviere
            message=_ "Baron Richard de Ferres placed his men in the centre. I have seen his soldiers in action more than once; only heavy infantrymen can withstand their onslaught."
        [/message]

        {VARIABLE_OP scout add 1}
    [/event]

    [event]
    name=sighted 

        [filter]
            id=Grey
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [message]
            scroll=no
            speaker=Asheviere
            message=_ "I have seen his soldiers in action more than once; only heavy infantrymen can withstand their onslaught."
        [/message]

        [message]
            scroll=no
            speaker=Vashna
            message=_ "I know how to handle these iron things. I have enough archers, assassins, and trolls on hand to weaken them before they reach our main forces."
        [/message]

        {VARIABLE_OP scout add 1}
    [/event]

    [event]
    name=last_breath 

        [filter]
            id=Aran 
        [/filter]

        {VARIABLE_OP Aran_defeated add 1}
        {VARIABLE_OP victory add 1}

        [message]
            speaker=unit 
            sound=horn-signals/horn-3.ogg 
            message=_ "No, it's not over! I'm not going to the royal dogs. I'm retreating, but know, Ashevir, we will meet again!"
        [/message]

        [message]
            speaker=Asheviere
            scroll=no
            message=_ "I hope next time you have the courage to die like the great knight you make yourself out to be, Aran."
        [/message]

        [if]
            [have_unit]
                id=Richard
            [/have_unit]
        [then]
        [/then]
        [else]
        [/else]
        [/if]

        [kill]
            side=2
            animate=no 
        [/kill]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_ "Following Sir Aran, his knights left the battlefield. At the next encounter, Sir Aran will have 100 less gold!"
        [/message]

        {CHECK_VICTORY}
    [/event]

    [event]
    name=last_breath 

        [filter]
            id=Grey
        [/filter]

        {VARIABLE_OP Grey_defeated add 1}
        {VARIABLE_OP victory add 1}

        [message]
            speaker=unit 
            sound=horn-signals/horn-4.ogg 
            message=_ "The warrior's luck has betrayed us, but if I let myself get killed, it'll be worse. Soldiers, fall back!"
        [/message]

        [message]
            speaker=Asheviere
            scroll=no
            message=_ "Grey and his soldiers try to escape in their heavy armor; a laughable sight. Garard would surely rush in pursuit, and stretching his forces would set himself up for a hit. I guess I won't do that."
        [/message]

        [if]
            [have_unit]
                id=Richard
            [/have_unit]
        [then]
        [/then]
        [else]
        [/else]
        [/if]

        [kill]
            side=4
            animate=no 
        [/kill]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_ "Following Sir Grey, his heavy infantrymen left the battlefield. At the next encounter, Sir Grey will have 100 less gold!"
        [/message]

        {CHECK_VICTORY}
    [/event]

    [event]
    name=last_breath 

        [filter]
            id=Richard
        [/filter]

        {VARIABLE_OP Richard_defeated add 1}
        {VARIABLE_OP victory add 1}

        [message]
            speaker=unit 
            sound=horn-signals/horn-5.ogg 
            message=_ "Damn you and your orcs, witch. You may have won the battle, but you can't win the war. You will surely end up on the gallows for your crimes."
        [/message]

        [message]
            speaker=Asheviere
            scroll=no
            message=_ "Bemoan the fact that you couldn't defeat me sooner, Richard. You really had your chance. But it seems you lacked the leadership skills to keep the lords under your thumb. Ha-ha-ha-ha!"
        [/message]

        [if]
            [have_unit]
                id=Aran
            [/have_unit]
        [then]
        [/then]
        [else]
        [/else]
        [/if]

        [kill]
            side=3
            animate=no 
        [/kill]

        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message=_ "Following Baron Richard, his soldiers left the battlefield. At the next encounter, Baron Richard will have 100 less gold!"
        [/message]

        {CHECK_VICTORY}
    [/event]
[/scenario]
